### File managed with puppet ###

[main]
    logdir = /var/log/puppet
    rundir = /var/run/puppet
    <% unless @dns_alt_names.empty? -%>
    dns_alt_names = <%= @dns_alt_names.join(", ") %>
    <% end -%>
    ca_server = <%= @ca_server %>
    ssldir = $vardir/ssl

    # Allow services in the 'puppet' group to access key (Foreman + proxy)
    privatekeydir = $ssldir/private_keys { group = service }
    hostprivkey = $privatekeydir/$certname.pem { mode = 640 }

    # Puppet 3.0.x requires this in both [main] and [master] - harmless on agents
    autosign       = $confdir/autosign.conf { mode = 664 }

[agent]
    classfile = $vardir/classes.txt
    localconfig = $vardir/localconfig
    report      = true
    pluginsync  = true
    masterport  = 8140
    environment = <%= @environment %>
    certname    = <%= @fqdn %>
    server      = <%= @puppetmaster %>
    listen      = true

[master]
    autosign       = $confdir/autosign.conf { mode = 664 }
    reports        = foreman
    external_nodes = /etc/puppet/node.rb
    node_terminus  = exec
    <%- if @ca -%>
    ca             = true
    <%- else -%>
    ca             = false
    <%- end -%>

<%- @puppet_environments.each do |env| -%>
[<%= env %>]
    modulepath = /etc/puppet/modules/<%= env %>/customer:/etc/puppet/modules/<%= env %>/forge
<%- end -%>
