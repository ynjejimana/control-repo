<% if @define_cacheobject %>
acl manager proto cache_object
<% end %>

<% if @dns_nameservers %>
<% dns_nameservers.each do |nameserver| %>
dns_nameservers <%= nameserver %>
<% end %>
<% end %>

acl localhost src 127.0.0.1/32 ::1
acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1

<% allowed_networks.each do |localnet| %>
acl localnet src <%= localnet %>
<% end %>

<% ssl_ports.each do |ssl_port| %>
acl SSL_ports port <%= ssl_port %>
<% end %>

<% safe_ports.each do |safe_port| %>
acl Safe_ports port <%= safe_port %>
<% end %>

<% if @allow_ftp %>
acl FTP proto FTP
<% end %>

acl allowed_sites dstdomain "/etc/squid/allowed.sites.conf"

acl CONNECT method CONNECT

http_access allow manager localhost
<% if @allow_ftp %>
http_access allow ftp
<% end %>
http_access deny manager
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
<% if @allow_all %>
http_access allow localnet
<% end %>
http_access allow localnet allowed_sites
http_access allow localhost
http_access deny all

http_port 0.0.0.0:<%= http_port %>
<% if @allow_ftp %>
always_direct allow FTP
<% end %>

<% if @hosts_file %>
hosts_file /etc/hosts
<% end %>

hierarchy_stoplist cgi-bin ?

coredump_dir /var/spool/squid
<% if @cache_peer_options -%>
cache_peer <%= @cache_peer_options %>
<% end -%>

<% if @never_direct_all -%>
never_direct allow all
<% end -%>

<% if @log_to_file -%>
access_log /var/log/squid/access.log squid
<% end -%>
<% if @log_to_syslog -%>
access_log syslog:user.warning
<% end -%>
