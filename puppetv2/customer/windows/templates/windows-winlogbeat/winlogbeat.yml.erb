# Puppet managed config file, DO NOT MODIFY MANUALLY

winlogbeat.event_logs:
  <%- @winlogbeat_eventlogs.each do |name, options| -%>
  - name: <%= options['name'] || name %>
    <%- if options['ignore_older'] != nil -%>
    ignore_older: <%= options['ignore_older'] %>
    <%- end -%>
    <%- if options['forwarded'] != nil -%>
    forwarded: <%= options['forwarded'] %>
    <%- end -%>
    <%- if options['event_id'] != nil -%>
    event_id: <%= options['event_id'] %>
    <%- end -%>
    <%- if options['level'] != nil -%>
    level: <%= options['level'] %>
    <%- end -%>
    <%- if options['provider'] != nil -%>
    provider:
    <%- options['provider'].each do |p| -%>
      - <%= p %>
    <%- end -%>
    <%- end -%>
    <%- if options['include_xml'] != nil -%>
    include_xml: <%= options['include_xml'] %>
    <%- end -%>
    <%- if options['tags'] != nil -%>
    tags:
    <%- options['tags'].each do |tag| -%>
      - <%= tag %>
    <%- end -%>
    <%- end -%>
    <%- if options['fields'] != nil -%>
    fields:
      <%- options['fields'].each_pair do |k, v| -%>
      <%= k %>: <%= v %>
      <%- end -%>
    <%- end -%>
    <%- if options['fields_under_root'] != nil -%>
    fields_under_root: <%= options['fields_under_root'] %>
    <%- end -%>
  <%- end -%>
#================================ General ======================================

name: <%= @fqdn %>
<%- if @winlogbeat_general_tags != nil -%>
tags:
<%- @winlogbeat_general_tags.each do |tag| -%>
  - <%= tag %>
<%- end -%>
<%- end -%>

<%- if @winlogbeat_general_fields != nil -%>
fields:
  <%- @winlogbeat_general_fields.each do |k, v| -%>
  <%= k %>: <%= v %>
  <%- end -%>
<%- end -%>

# The internal queue size for bulk events in the processing pipeline.
# Do not modify this value.
#bulk_queue_size: 0

<%- if @winlogbeat_general_max_procs != nil -%>
max_procs: <%= @winlogbeat_general_max_procs %>
<%- end -%>

#================================ Processors ===================================

# Processors are used to reduce the number of fields in the exported event or to
# enhance the event with external metadata. This section defines a list of
# processors that are applied one by one and the first one receives the initial
# event:
#
#   event -> filter1 -> event1 -> filter2 ->event2 ...
#
# The supported processors are drop_fields, drop_event, include_fields, and
# add_cloud_metadata.
#
# For example, you can use the following processors to keep the fields that
# contain CPU load percentages, but remove the fields that contain CPU ticks
# values:
#
#processors:
#- include_fields:
#    fields: ["cpu"]
#- drop_fields:
#    fields: ["cpu.user", "cpu.system"]
#
# The following example drops the events that have the HTTP response code 200:
#
#processors:
#- drop_event:
#    when:
#       equals:
#           http.code: 200
#
# The following example enriches each event with metadata from the cloud
# provider about the host machine. It works on EC2, GCE, and DigitalOcean.
#
<%- if @winlogbeat_processors_add_cloud_metadata != nil -%>
processors:
- add_cloud_metadata: ~
<%- end -%>

#================================ Outputs ======================================

#----------------------------- Logstash output --------------------------------
<% @winlogbeat_outputs.each do |key,value| -%>
output.<%= value['type'] %>:
  enabled: true
  hosts: [<%= value['hosts'].map{ |host| "\"#{host}\""}.join(', ') %>]
  max_retries: <%= value['max_retries'] %>
<% if (value['cafile'] != nil) then -%>
  ssl.certificate_authorities: ['<%= value['cafile'] %>']
<% end -%>
<%- if (value['verificationmode'] != nil) then -%>
  ssl.verification_mode: ['<%= value['verificationmode'] %>']
<%- end -%>
  ssl.enabled: <%= value['ssl_enabled'] %>
  loadbalance: <%= value['loadbalance'] %>
  compression_level: <%= value['compression_level'] %>
  worker: <%= value['worker'] %>
<% end -%>



#================================ Logging ======================================
logging.to_files: <%= @winlogbeat_logtofiles %>
logging.level: <%= @winlogbeat_loglevel %>
logging.files:
  path: '<%= @winlogbeat_logdir %>'
  name: <%= @winlogbeat_logfile %>
  rotateeverybytes: <%= @winlogbeat_logbytes %>
  keepfiles: <%= @winlogbeat_loggingkeepfiles %>
